# ТЕХНИЧЕСКОЕ ЗАДАНИЕ

## Backend-система сервиса доставки с использованием беспилотных летательных аппаратов

---

## 1. Назначение системы

Backend-система предназначена для обеспечения серверной логики сервиса доставки с использованием беспилотных летательных аппаратов (БПЛА), включая управление заказами, полётами дронов, обработку телеметрии, интеграцию с внешними системами и обеспечение безопасного доступа к данным.

Система должна быть готова к промышленной эксплуатации и масштабированию.

---

## 2. Архитектура и технологический стек

### 2.1 Архитектурный подход

* Stateless REST API
* Асинхронная обработка запросов
* Поддержка WebSocket для передачи данных в реальном времени
* Поддержка приёма телеметрии через MQTT

### 2.2 Рекомендуемый технологический стек

* Язык программирования: Python 3.11+
* Backend-фреймворк: FastAPI
* ASGI-сервер: Uvicorn / Gunicorn
* База данных: PostgreSQL
* ORM: SQLAlchemy / SQLModel
* MQTT-брокер: EMQX / Mosquitto
* Очереди сообщений (при необходимости): Redis / RabbitMQ
* Контейнеризация: Docker
* Оркестрация (опционально): Kubernetes

---

## 3. Аутентификация и безопасность

### 3.1 Аутентификация

* Тип аутентификации: JWT (JSON Web Token)
* Алгоритм подписи: HS256 или RS256
* Использование Access Token с ограниченным сроком действия
* Поддержка Refresh Token (опционально)

JWT должен передаваться в заголовке:

```
Authorization: Bearer <token>
```

Токен должен содержать:

* идентификатор пользователя или сервиса;
* роль (role);
* срок действия (exp).

---

### 3.2 Авторизация

* Реализация ролевой модели доступа (RBAC)

Минимальный набор ролей:

* admin
* operator
* external_partner
* drone_device

Доступ к эндпоинтам должен быть ограничен в соответствии с ролью и назначением клиента.

---

### 3.3 Защита API

* Принудительное использование HTTPS
* Ограничение частоты запросов (rate limiting)
* Проверка и валидация входных данных
* Защита от brute-force атак
* Ограничение CORS
* Отключение debug-режима в production

---

### 3.4 Управление конфигурацией

* Все секреты и параметры конфигурации должны храниться во внешних переменных окружения
* Запрещено хранение секретов в коде или репозитории
* Поддержка различных окружений (development / staging / production)

---

## 4. Функциональные требования backend

### 4.1 Управление заказами

* Создание заказа доставки
* Получение текущего статуса заказа
* Привязка заказа к дрону
* Расчёт времени доставки (ETA)
* Хранение истории изменений статуса

---

### 4.2 Управление дронами

* Регистрация и хранение данных о дронах
* Получение текущего состояния дрона
* Назначение маршрутов
* Поддержка симуляции полётов на этапе MVP

---

### 4.3 Обработка телеметрии

* Приём телеметрических данных от дронов и термобоксов
* Поддержка передачи данных через MQTT
* Обработка следующих параметров:

  * географические координаты;
  * высота;
  * температура;
  * уровень заряда;
  * временные метки.
* Валидация и нормализация входящих данных
* Сохранение данных в базе данных

---

### 4.4 Взаимодействие в реальном времени

* WebSocket-соединения для передачи:

  * координат дронов;
  * статусов доставки.
* Аутентификация WebSocket-соединений с использованием JWT
* Поддержка повторного подключения клиентов

---

## 5. Хранение данных

Минимальный набор сущностей:

* пользователи и сервисные аккаунты;
* заказы;
* дроны;
* телеметрия;
* сессии полётов;
* журналы аудита.

Требования:

* использование индексов по временным и географическим полям;
* поддержка миграций схемы базы данных;
* soft delete для критичных сущностей.

---

## 6. Логирование и аудит

* Централизованное логирование
* Формат логов: структурированный (JSON)
* Логирование:

  * ошибок;
  * операций аутентификации;
  * действий с заказами и дронами.
* Ведение журнала аудита для критических операций

---

## 7. Тестирование

* Модульные тесты бизнес-логики
* Тестирование API-эндпоинтов
* Проверка сценариев аутентификации и авторизации
* Минимальное покрытие тестами: не менее 70%

---

## 8. Развёртывание и эксплуатация

* Docker-образ для production
* Health-check эндпоинт
* Поддержка graceful shutdown
* Возможность горизонтального масштабирования
* Поддержка обновлений без простоя (rolling update)

---

## 9. Документация

* OpenAPI 3.0 (Swagger)
* Документация всех эндпоинтов
* Описание ролей, прав доступа и кодов ошибок
* Отдельное описание интеграции для внешних партнёров

---

## 10. Нефункциональные требования

* Доступность сервиса: не ниже 99.5%
* Среднее время ответа API: до 300 мс
* Возможность расширения под подключение реальных устройств и дополнительных сервисов
* Готовность к промышленной эксплуатации

---

Если нужно, следующим шагом можно:

* провести аудит текущего кода на соответствие этому ТЗ;
* оформить security-checklist для production;
* разбить требования на этапы реализации.
